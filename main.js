(()=>{"use strict";function e(e,t,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__like-button"),i=c.querySelector(".card__likes"),l=c.querySelector(".card__delete-button");return e.owner._id!==o&&(l.style.display="none"),l.addEventListener("click",(function(){return t(c,e._id)})),a.src=e.link,a.alt=e.name,c.querySelector(".card__title").textContent=e.name,i.textContent=0,e.likes&&(i.textContent=e.likes.length,e.likes.some((function(e){return e._id===o}))&&u.classList.add("card__like-button_is-active")),c.querySelector(".card__delete-button").addEventListener("click",(function(){return t(c,e._id)})),a.addEventListener("click",(function(){return n(e.name,e.link)})),u.addEventListener("click",(function(){return r(u,i,e._id)})),c}function t(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}var o=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error, .").concat(t.name,"-error"));o&&(o.textContent=n,o.style.display="block",t.classList.add(r.inputErrorClass))},c=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error, .").concat(t.name,"-error"));r&&(r.textContent="",r.style.display="none",t.classList.remove(n.inputErrorClass))},a=/^[a-zA-Zа-яёА-ЯЁ\s-]+$/,u=/^(https?:\/\/)?([\w.-]+)\.([a-z]{2,})(\/.*)?$/i,i=function(e,t,n){return c(t,e,n),e.validity.valid?"url"!==e.type||u.test(e.value)?!("text"===e.type&&!a.test(e.value)&&(o(t,e,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",n),1)):(o(t,e,"Введите адрес сайта",n),!1):(o(t,e,e.validationMessage,n),!1)},l=function(e,t,n){var r=e.some((function(e){var t="text"!==e.type||a.test(e.value),n="url"!==e.type||u.test(e.value);return!e.validity.valid||!t||!n}));t.disabled=r,t.classList.toggle(n.inactiveButtonClass,r)},s=function(e,t){if(e){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);if(n.forEach((function(n){var r=".".concat(n.name,"-error, .").concat(n.id,"-error"),o=e.querySelector(r);o&&(n.classList.remove(t.inputErrorClass),o.textContent="",o.classList.remove(t.errorClass))})),r){var o=Array.from(e.querySelectorAll(t.inputSelector)).some((function(e){return!e.validity.valid}));r.disabled=o,r.classList.toggle(t.inactiveButtonClass,o)}}else console.error("Форма не найдена")},d={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"2c4712da-dea4-4c33-ad2f-6617402adbfd","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function f(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then((function(e){return p(e)}))}function _(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))}var m,y,v=document.querySelector(".places__list"),h=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),b=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),E=document.querySelector('.popup__form[name="edit-profile"]'),k=document.querySelector('.popup__form[name="new-place"]'),L=E.querySelector(".popup__input_type_name"),g=E.querySelector(".popup__input_type_description"),x=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),U=k.querySelector(".popup__input_type_card-name"),B=k.querySelector(".popup__input_type_url"),T=(document.querySelector(".popup__form"),document.querySelector(".profile__title")),w=document.querySelector(".profile__image"),P=E.elements.name,D=E.elements.description,N=document.forms["update-avatar"],O="Сохранение...",j=document.querySelector(".profile__image-overlay"),z=document.querySelector(".popup_type_update-avatar"),J=N.elements["avatar-input"],G={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function H(e,t,n){(e.classList.contains("card__like-button_is-active")?_:f)(n).then((function(n){t.textContent=n.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error("Ошибка при обновлении лайка:",e)}))}function I(e,t){var r=q.querySelector(".popup__image"),o=q.querySelector(".popup__caption");r.src=t,r.alt=e,o.textContent=e,n(q)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){i(o,e,t),l(n,r,t),"url"===o.type&&u.test(o.value)&&c(e,o,t)})),o.addEventListener("blur",(function(){i(o,e,t)}))})),l(n,r,t)}(t,e)}))}(G),Promise.all([fetch("".concat(d.baseUrl,"/users/me"),{method:"GET",headers:d.headers}).then((function(e){return p(e)})),fetch("".concat(d.baseUrl,"/cards"),{method:"GET",headers:d.headers}).then((function(e){return p(e)}))]).then((function(t){var n=t[0],r=t[1];n&&(T.textContent=n.name,A.textContent=n.about,w.style.backgroundImage="url('".concat(n.avatar,"')")),r.length>0&&r.forEach((function(t){var r=e(t,$,I,H,n._id);v.append(r)}))})).catch((function(e){console.log(e)})),N.addEventListener("submit",(function(e){e.preventDefault();var t,n=N.querySelector(G.submitButtonSelector),o=n.textContent;n.textContent="Сохранение...",(t=J.value,fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then((function(e){return p(e)}))).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"),r(z)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){n.textContent=o}))})),b.addEventListener("click",(function(){L.value=x.textContent,g.value=A.textContent,s(E,G),n(h)})),C.addEventListener("click",(function(){n(S)})),E.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=E.querySelector(G.submitButtonSelector),c=o.textContent;o.textContent=O,(t=P.value,n=D.value,fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return p(e)}))).then((function(e){T.textContent=e.name,A.textContent=e.about,r(h)})).finally((function(){o.textContent=c}))})),k.addEventListener("submit",(function(t){t.preventDefault();var n=k.querySelector(G.submitButtonSelector),o=n.textContent;n.textContent=O;var c,a,u={name:U.value,link:B.value};(c=u.name,a=u.link,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:c,link:a})}).then((function(e){return p(e)}))).then((function(t){var n=e(t,$,I,H,t.owner._id);v.prepend(n),k.reset(),s(k,G),r(S)})).catch((function(e){console.error("Ошибка при создании карточки:",e)})).finally((function(){n.textContent=o}))})),m=document.querySelectorAll(".popup"),y=document.querySelectorAll(".popup__close"),m.forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&r(e)}))})),y.forEach((function(e){e.addEventListener("click",(function(){r(e.closest(".popup"))}))})),j.addEventListener("click",(function(){N.reset(),s(N,G),n(z)}));var $=function(e,t){var n;(n=t,fetch("".concat(d.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))).then((function(){e.remove()})).catch((function(e){console.log("Ошибка: ".concat(e))}))}})();